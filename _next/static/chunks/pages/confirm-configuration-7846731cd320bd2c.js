(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[489],{84679:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/confirm-configuration",function(){return t(19742)}])},19742:function(e,s,t){"use strict";t.r(s);var a=t(85893),i=t(67294),r=t(71866),n=t(64146),l=t(28014),c=t(3441),o=t(41518),d=t(87536),h=t(2504),u=t(21237),p=t(80050),x=t(11163),g=t(98064),v=t(37005),m=t(4010),f=t(23500),j=t(28106);let w=()=>{let e,s;let{account:t,provider:w,chainId:y}=(0,h.kR)(),{handleSubmit:S}=(0,d.cI)({mode:"onChange"}),C=(0,x.useRouter)(),[_,A]=(0,i.useState)(),[b,k]=(0,i.useState)(),[$,R]=(0,i.useState)(!1),[N,E]=(0,i.useState)(""),[I,O]=(0,i.useState)(),[D,W]=(0,i.useState)(),[T,H]=(0,i.useState)(!1),[F,P]=(0,i.useState)(""),z="v1.7.0",[K,B]=(0,i.useState)(!1),[M,Z]=(0,i.useState)(""),[L,U]=(0,i.useState)(""),X=(0,o.o)(e=>e.clusterDefinition),Y=(null==X?void 0:X.principal)&&!(null==X?void 0:X.singleAddress)&&(null==X?void 0:X.recipients.every(e=>(0,u.H6)(e))),J=!(null==X?void 0:X.principal)&&!(null==X?void 0:X.singleAddress)&&(null==X?void 0:X.recipients.every(e=>(0,u.H6)(e))),Q=!(null==X?void 0:X.principal)&&(null==X?void 0:X.singleAddress)&&!(null==X?void 0:X.recipients.every(e=>(0,u.H6)(e)));Y?(e="Rewards",s="Deploy Optimistic Withdrawal Recipient Contract"):J&&(e="Principal & Rewards",s="Deploy Splitter Contract");let V=null==X?void 0:X.operators.some(e=>e.address===t),q=(0,o.o)(e=>e.updateClusterDefinition),G=(0,o.o)(e=>e.completeLeaderStep),ee=(0,o.o)(e=>e.enableLeaderStep),es=()=>{A(null),k(null),E(""),O(""),W(""),R(!1)},et=e=>{console.log(e),es()},ea=async e=>{let s=await (0,p.c0)({token:e,data:_});if(!s.data.config_hash)throw"no config hash returned";E(s.data.config_hash)};(0,i.useEffect)(()=>{if(_){let e=async()=>{try{let e={creator_config_hash:_.config_hash},s=await (0,u.L6)(w,y,t,e);if(await ea(s),V){let e={operator_config_hash:_.config_hash},s=await (0,u.AM)(w,y,t,e);W(s);let a={enr:null==X?void 0:X.enr},i=await (0,u.Ol)(w,y,t,a);O(i)}}catch(e){et(e)}};e()}},[_]),(0,i.useEffect)(()=>{if(V&&b&&N||!V&&N){G("confirm-configuration");let e=ee("invite-group");R(!1),C.push({pathname:e.href,query:{configHash:N}})}},[b,N]),(0,i.useEffect)(()=>{if(V&&I&&D&&N){let e=async()=>{let e={address:t,enr:null==X?void 0:X.enr,enr_signature:I,fork_version:c.se,version:z},{data:s}=await (0,p.R)({token:D,data:e,configHash:N});k(s)};e().catch(et)}},[I,N]);let ei=()=>(0,a.jsx)(l.W2,{className:"cluster-details",alignItems:"start",children:(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(j.uo,{}),(0,a.jsx)(r.VL,{operators:[...null==X?void 0:X.operators],currentAccount:t})]})}),er=()=>(0,a.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,a.jsx)(l.xv,{variant:"subline",color:"body",css:{textTransform:"uppercase"},children:"Your Charon client ENR"}),(0,a.jsx)(l.KZ,{content:'An ENR is an "Ethereum Node Record" used to identify your client to the other clients in the cluster"',children:(0,a.jsx)(l.xu,{css:{display:"flex"},children:(0,a.jsx)(l.by,{})})})]}),(0,a.jsx)(r.Kx,{css:{minHeight:"115px"},placeholder:"Your enr",value:null==X?void 0:X.enr,readOnly:!0})]}),(0,a.jsxs)(l.rU,{href:"https://docs.obol.tech/docs/next/int/faq/errors#enrs-keys",target:"_blank",children:["More on Ethereum Node Records ",(0,a.jsx)(l.ZJ,{})]})]}),en=async e=>{let{recipientsAddresses:s,splitPercentages:t,splitMainContract:a}=e;try{let e=await (0,f.s8)(s,t,a);console.log("realSplitAddress",e),q({...X,validators:Array(X.validatorsSize).fill({feeRecipientAddress:e,withdrawalAddress:e})}),P(e);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw console.log(e,"errorMessage"),Z(e),s}},el=async e=>{let{recipientsAddresses:s,splitPercentages:t,predictedSplitAddress:a}=e;try{let{owrAddress:e,splitAddress:i}=await (0,f.KZ)({principalRecipient:X.principal,amountOfPrincipalStake:32*X.validatorsSize},{accounts:s,percentAllocations:t},a,w.getSigner(0));q({...X,validators:Array(X.validatorsSize).fill({feeRecipientAddress:i,withdrawalAddress:e})}),P(i);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw Z(e),s}},ec=async e=>{try{let s=await (0,f.Sf)(X.principal,e,32*X.validatorsSize,w.getSigner(0));console.log(s,"OWRecipientContractAddresses"),q({...X,validators:Array(X.validatorsSize).fill({feeRecipientAddress:e,withdrawalAddress:s})}),P(e);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw Z(e),s}},eo=async e=>{if(e.preventDefault(),!T){H(!0);try{if(!(await (0,u.wB)(c.eh,w)&&await (0,u.wB)(c.wi,w)&&await (0,u.wB)(c.nU,w))){Z(c.sD),H(!1);return}let e=[...X.recipients];e.sort((e,s)=>e.address.localeCompare(s.address));let s=e.map(e=>e.address),t=e.map(e=>{let s=(1e4*parseFloat(e.split)).toFixed(0);return parseInt(s)}),a=new n.Contract(c.wi,m.Mt,null==w?void 0:w.getSigner(0)),i=await a.predictImmutableSplitAddress(s,t,c.Uu);console.log("predictedSplitAddress",i);let r=await (0,f.Kv)(i,y);console.log(r,"isSplitterDeployed"),Y?r?(await ec(i),U(c.Oy)):await el({recipientsAddresses:s,splitPercentages:t,predictedSplitAddress:i}):J&&(r?(q({...X,validators:Array(X.validatorsSize).fill({feeRecipientAddress:i,withdrawalAddress:i})}),P(i),U(c.Oy)):await en({recipientsAddresses:s,splitPercentages:t,splitMainContract:a})),H(!1)}catch(e){console.log(e,"errr"),H(!1)}}},ed=(0,i.useMemo)(()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ei,{}),(0,a.jsx)(j.XD,{}),V&&(0,a.jsx)(er,{}),(0,a.jsxs)(l.W2,{className:"withdrawal-section",css:{gap:"$xl"},alignItems:"start",children:[(0,a.jsx)(l.xv,{variant:"h4",children:"Withdrawal Configuration"}),"Rewards"===e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.nB,{heading:"Principal Address",description:"Address to receive validator principal and rewards at exit..",value:null==X?void 0:X.principal,className:"principal-address-section"}),(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xs"},children:[(0,a.jsxs)(l.xv,{variant:"h5",children:[e," Split"]}),(0,a.jsx)(l.xv,{color:"body",variant:"body",children:"Explainer of what these are"}),(0,a.jsx)(g.I,{recipients:X.recipients,type:e})]}),F&&(0,a.jsxs)(l.W2,{variant:"card",className:"enr-section",alignItems:"start",css:{gap:"$sm",p:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$sm"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.nQ,{})}),(0,a.jsx)(l.xu,{css:{display:"flex",fd:"column",gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"body",css:{color:"white"},children:"Optimistic Withdrawal Recipient Contract Successfully Deployed"})})]}),(0,a.jsx)(l.xv,{color:"body",variant:"subline",css:{lineHeight:"$lg",textTransform:"uppercase",letterSpacing:"1px"},children:"Optimistic Withdrawal Recipient Contract Address"}),(0,a.jsx)(l.IK,{readOnly:!0,value:X.validators[0].withdrawalAddress}),(0,a.jsxs)(l.rU,{href:"https://".concat(c.pn,".etherscan.io/address/").concat(X.validators[0].withdrawalAddress,"#code"),target:"_blank",children:["View on Etherscan ",(0,a.jsx)(l.ZJ,{})]})]})]}),"Principal & Rewards"===e&&(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xs"},children:[(0,a.jsxs)(l.xv,{variant:"h5",children:[e," Split"]}),(0,a.jsx)(l.xv,{color:"body",variant:"body",children:"Explainer of what these are"}),(0,a.jsx)(g.I,{recipients:X.recipients,type:e,validatorsSize:X.validators.length})]}),F&&(0,a.jsxs)(l.W2,{variant:"card",className:"enr-section",alignItems:"start",css:{gap:"$sm",p:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$sm"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.nQ,{})}),(0,a.jsx)(l.xu,{css:{display:"flex",fd:"column",gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"body",css:{color:"white"},children:"Splitter Contract Successfully Deployed"})})]}),(0,a.jsx)(l.xv,{color:"body",variant:"subline",css:{lineHeight:"$lg",textTransform:"uppercase",letterSpacing:"1px"},children:"Splitter Contract Address"}),(0,a.jsx)(l.IK,{readOnly:!0,value:F}),(0,a.jsxs)(l.rU,{href:"https://".concat(c.pn,".etherscan.io/address/").concat(F,"#code"),target:"_blank",children:["View on Etherscan ",(0,a.jsx)(l.ZJ,{})]})]}),!F&&(0,a.jsx)(r.fl,{color:"primary",type:"button",onClick:eo,disabled:!!M,children:(0,a.jsxs)(a.Fragment,{children:[T&&(0,a.jsx)(l.yC,{}),s]})}),L&&(0,a.jsx)(l.xv,{variant:"metadata",color:"testHover",children:L}),M&&(0,a.jsx)(l.xv,{variant:"metadata",color:"test",children:M})]})]}),[F,T,M,X]),eh=(0,i.useMemo)(()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ei,{}),(0,a.jsx)(j.XD,{}),V&&(0,a.jsx)(er,{}),(0,a.jsxs)(l.W2,{className:"withdrawal-section",css:{gap:"$lg"},alignItems:"start",children:[(0,a.jsx)(l.xv,{variant:"h4",children:"Withdrawal Configuration"}),(0,a.jsx)(j.nB,{heading:"Principal Address",description:"The withdrawal address or contract will receive 100%.",value:null==X?void 0:X.singleAddress,className:"single-address-section"}),(0,a.jsx)(j.nB,{heading:"Fee Recipient Address",description:"Address to receive transaction fees from block proposals.",value:null==X?void 0:X.feeRecipientAddress,className:"fee-recipient-address-section"})]})]}),[X]);if(!X)return(0,a.jsx)(l.xv,{children:"No cluster data ..."});let eu=async()=>{if($)return;console.log(JSON.stringify(X),"currentClusterData");let e=(0,u.KH)(X,z);console.log(e.config_hash,"config_hashconfig_hash"),A(e),R(!0)};return(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(l.xv,{variant:"h3",children:"Confirm Configuration"}),(0,a.jsx)(r.l0,{onSubmit:S(eu),children:(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(v.T,{name:"reward_split_withdrawal_flow",children:Y&&ed}),(0,a.jsx)(v.T,{name:"split_withdrawal_flow",children:J&&ed}),(0,a.jsx)(v.T,{name:"single_withdrawal_address_flow",children:Q&&eh}),(0,a.jsx)(l.kC,{direction:"column",css:{gap:"$lg"},children:(0,a.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,a.jsx)(l.kC,{direction:"column",css:{gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"h4",children:"Confirm Details "})}),(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xl"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$xs",width:"$full"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.XZ,{checked:K,onCheckedChange:()=>B(!K)})}),(0,a.jsx)(l.xv,{variant:"body",children:"You will be prompted to sign a message with your wallet. This signature is attesting to the fact that:"})]}),(0,a.jsx)(l.sQ,{heading:"You have confirmed the withdrawal address for the validators to be created is correct. If this address is a contract, you have confirmed the contract implementation is correct. If this address is an externally-owned account, you have confirmed that the EOA custody is secure."}),(0,a.jsx)(l.sQ,{heading:"You have submitted your charon node's Ethereum Node Record (ENR) correctly. This signature is the authorisation of this charon client to act on your behalf."})]}),(0,a.jsx)(r.fl,{color:"primary",type:"submit",disabled:!Q&&!F||!K,children:(0,a.jsxs)(a.Fragment,{children:[$&&(0,a.jsx)(l.yC,{}),"Confirm and Sign"]})})]})})]})})]})};s.default=w,w.layout="ProgressTrackerLayout"}},function(e){e.O(0,[774,888,179],function(){return e(e.s=84679)}),_N_E=e.O()}]);